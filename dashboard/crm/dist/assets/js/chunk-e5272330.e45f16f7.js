(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e5272330"],{"0cfc":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tabBox"},[a("a-empty",{directives:[{name:"show",rawName:"v-show",value:0==t.groupList.length&&1==t.isNotAdd,expression:"groupList.length == 0 && isNotAdd == 1"}]},[a("span",{attrs:{slot:"description"},slot:"description"},[t._v("\n\t\t\t尚未创建标签，无法选择标签\n\t\t")])]),t._l(t.groupList,(function(e,i){return[t.isMore||!t.isMore&&i<5?a("a-form-item",{staticClass:"current0",attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("span",{staticClass:"group-name",attrs:{slot:"label"},slot:"label"},[e.name&&""!=e.name?a("a-popover",{attrs:{trigger:"hover"}},[a("span",{staticStyle:{display:"inline-block","max-width":"500px","word-wrap":"break-word","word-break":"break-all"},attrs:{slot:"content"},slot:"content"},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")]),t._v("\n\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t")]):t._e()],1),t._l(e.data,(function(s,n){return a("span",[e.disabled[n]?t._e():a("a-checkable-tag",{on:{change:function(e){return t.changeTags(s.id,i)}},model:{value:e.checked[n],callback:function(a){t.$set(e.checked,n,a)},expression:"item.checked[tagIndex]"}},[t._v("\n\t\t\t\t\t"+t._s(s.tagname)+"\n\t\t\t\t")]),e.disabled[n]&&1==t.isDisabled?a("a-button",{staticStyle:{margin:"5px","line-height":"26px","font-size":"12px",height:"auto !important",padding:"0 7px"},attrs:{disabled:e.disabled[n]&&1==t.isDisabled}},[t._v("\n\t\t\t\t\t"+t._s(s.tagname)+"\n\t\t\t\t")]):t._e()],1)})),1!=t.isNotAdd?a("a-button",{directives:[{name:"has",rawName:"v-has",value:"client-tag-add",expression:"'client-tag-add'"}],staticStyle:{"font-size":"13px",height:"26px"},attrs:{icon:"plus"},on:{click:function(a){return t.createTag(e.id)}}},[t._v("\n\t\t\t\t新建标签\n\t\t\t")]):t._e()],2):t._e()]})),t.groupList.length>0&&1!=t.isNotAdd?a("a-button",{directives:[{name:"has",rawName:"v-has",value:"client-tag-group-add",expression:"'client-tag-group-add'"}],staticStyle:{"font-size":"13px",height:"26px","margin-right":"10px","margin-left":"16.7%"},attrs:{icon:"plus"},on:{click:t.addTagGroup}},[t._v("\n\t\t新建标签组\n\t")]):t._e(),t.groupList.length>5?a("div",{staticStyle:{"font-size":"13px",height:"26px",color:"#1890FF","text-align":"center",cursor:"pointer"},on:{click:t.showMore}},[t.isMore?t._e():[t._v("更多")],t.isMore?[t._v("收起")]:t._e(),a("a-icon",{attrs:{type:t.isMore?"arrow-up":"arrow-down"}})],2):t._e(),a("a-modal",{attrs:{title:"新建标签",zIndex:99999,confirmLoading:t.confirmLoading3,width:"550px"},on:{ok:function(e){return t.handleOk(t.inputValue)},cancel:t.cancel},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-form-item",{attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("template",{slot:"label"},[t._v("\n\t\t\t\t选择分组\n\t\t\t")]),a("a-select",{staticStyle:{width:"250px"},attrs:{showSearch:"",optionFilterProp:"children",disabled:""},model:{value:t.group_id,callback:function(e){t.group_id=e},expression:"group_id"}},t._l(t.groupList,(function(e){return a("a-select-option",{attrs:{value:e.id}},[t._v("\n\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t")])})),1)],2),a("a-form-item",{attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("template",{slot:"label"},[t._v("\n\t\t\t\t标签名称\n\t\t\t")]),a("p",{staticStyle:{margin:"0px","font-size":"13px",color:"#909399"}},[t._v("\n\t\t\t\t每个标签名称最多15个字。同时新建多个标签时，请用“空格”隔开")]),a("a-input",{attrs:{placeholder:"请输入标签（不得超过15个字符）"},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}})],2)],1),a("a-modal",{staticClass:"add-tag-group",attrs:{zIndex:99999,title:"新建标签组",visible:t.groupVisible,confirmLoading:t.confirmLoading},on:{ok:t.handleOk2,cancel:t.handleCancel}},[a("a-form-item",{staticClass:"current0",attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("template",{slot:"label"},[a("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("分组名称\n\t\t\t")]),a("a-input",{attrs:{placeholder:"请输入分组名(不得超过15个字符)",maxLength:15},model:{value:t.teamName,callback:function(e){t.teamName=e},expression:"teamName"}},[a("span",{attrs:{slot:"suffix"},slot:"suffix"},[a("span",[t._v(t._s(t.teamName.length))]),t._v("/15\n\t\t\t\t\t\t\t\t\t\t\t")])])],2),a("a-form-item",{staticClass:"current0",attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("template",{slot:"label"},[a("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("标签名称\n\t\t\t")]),a("p",{staticStyle:{margin:"0px","font-size":"13px",color:"#909399"}},[t._v("\n\t\t\t\t每个标签名称最多15个字。同时新建多个标签时，请用“空格”隔开\n\t\t\t")]),a("a-input",{attrs:{placeholder:"请输入标签（不得超过15个字符）"},model:{value:t.inputValue2,callback:function(e){t.inputValue2=e},expression:"inputValue2"}})],2)],1)],2)},s=[],n=(a("a481"),a("28a5"),a("6762"),a("2fdb"),a("96cf"),a("3b8d")),o=(a("c5f6"),{name:"chooseDepartment",props:{callback:{type:Function,default:null},hasChoose:{type:Array,default:function(){}},isDisabled:{type:Number,default:0},disabledTag:{type:Array,default:function(){}},isNotAdd:{type:Number,default:0},id:{type:String,default:""}},data:function(){return{corpId:"",groupList:[],tag_arr:[],tag_ids:"",group_id:[],checked:[],visible:!1,confirmLoading3:!1,inputValue:"",newTagList:[],isMore:!1,groupVisible:!1,confirmLoading:!1,teamName:"",inputValue2:"",newTagList2:[]}},watch:{hasChoose:{handler:function(t){var e=this;"undefined"!=typeof t&&this.groupList.length&&(this.tag_arr=t,this.tag_ids=t.join(),this.hasChoose.map((function(t){e.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.checked[i]=!0)}))}))})),0==t.length&&this.groupList.map((function(t){t.checked=[]})),this.$forceUpdate())},deep:!0},id:{handler:function(t){""!=typeof t&&(this.corpId=t,this.getTags())},deep:!0},disabledTag:{handler:function(t){var e=this;"undefined"!=typeof t&&this.groupList.length&&(this.disabledTag.map((function(t){e.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.disabled[i]=!0)}))}))})),this.$forceUpdate())},deep:!0}},methods:{getTags:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag-group/tag-group",{corp_id:this.corpId||localStorage.getItem("corpId"),is_not_add:this.isNotAdd});case 2:e=t.sent,a=e.data,0!=a.error?this.$message.error(a.error_msg):(this.groupList=a.data,this.groupList.map((function(t){t.checked=[],t.disabled=[]})),"undefined"!=typeof this.disabledTag&&this.disabledTag.length>0&&this.disabledTag.map((function(t){i.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.disabled[i]=!0)}))}))})),"undefined"!=typeof this.hasChoose&&this.hasChoose.length>0&&(this.tag_arr=this.hasChoose,this.tag_ids=this.hasChoose.join(),this.hasChoose.map((function(t){i.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.checked[i]=!0)}))}))})),this.$forceUpdate()));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),changeTags:function(t,e){Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)};var a=String(t);if(this.tag_arr.includes(a))this.tag_arr.remove(a);else if(this.tag_arr.length+1>9999){this.$message.warning("不可选中，客户标签数量上限9999个");for(var i=0;i<this.groupList[e].data.length;i++)this.groupList[e].data[i].id==a&&(this.groupList[e].checked[i]=!1)}else this.tag_arr.push(a);this.$forceUpdate(),this.tag_ids=this.tag_arr.join(),null!==this.callback&&"function"===typeof this.callback&&this.callback("ok",this.tag_ids)},createTag:function(t){this.group_id=t;var e=0;if(this.groupList.map((function(t){e+=t.data.length})),e>=9999)return this.$message.warning("标签数量已超过上限9999个，无法创建"),!1;this.visible=!0},handleOk:function(t){var e=this;if(e.confirmLoading3=!0,""==t)return e.$message.warning("不能为空"),e.confirmLoading3=!1,!1;e.newTagList=[];for(var a=0;a<t.split(" ").length;a++){if(t.split(" ")[a].length>15)return e.$message.error("每个标签最多15个字"),e.confirmLoading3=!1,!1;t.split(" ")[a].length>0&&e.newTagList.push(t.split(" ")[a])}e.addTags(),e.inputValue="",e.newTagList=[],e.confirmLoading3=!1},addTags:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag/add",{corp_id:this.corpId||localStorage.getItem("corpId"),suite_id:1,type:0,group_id:this.group_id,name:this.newTagList});case 2:e=t.sent,a=e.data,0!=a.error?(this.$message.error(a.error_msg),this.confirmLoading3=!1):(this.isLoading=!1,this.visible=!1,this.confirmLoading3=!1,this.getTags(),this.inputValue="",this.newTagList=[]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),cancel:function(){this.visible=!1,this.inputValue=""},showMore:function(){this.isMore=!this.isMore},addTagGroup:function(){this.groupVisible=!0},handleCancel:function(){this.groupVisible=!1,this.teamName="",this.newTagList2=[],this.inputValue2=""},handleOk2:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(String.prototype.Trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},this.teamName=this.teamName.Trim(),this.teamName){t.next=5;break}return this.$message.error("请输入分组名"),t.abrupt("return",!1);case 5:if(""!=this.inputValue2){t.next=10;break}return this.$message.warning("标签名称不能为空"),t.abrupt("return",!1);case 10:this.newTagList2=[],e=JSON.parse(JSON.stringify(this.inputValue2)).split(" "),a=0;case 13:if(!(a<e.length)){t.next=24;break}if(!(e[a].length>15)){t.next=20;break}return this.$message.error("每个标签最多15个字"),this.inputValue2="",t.abrupt("return",!1);case 20:e[a].length>0&&this.newTagList2.push(e[a]);case 21:a++,t.next=13;break;case 24:return this.confirmLoading=!0,t.next=27,this.axios.post("work-tag-group/add",{corp_id:this.corpId||localStorage.getItem("corpId"),suite_id:1,name:this.teamName,type:0,isMasterAccount:localStorage.getItem("isMasterAccount"),sub_id:localStorage.getItem("sub_id"),tag_name:this.newTagList2});case 27:i=t.sent,s=i.data,0!=s.error?this.$message.error(s.error_msg):(this.teamName="",this.newTagList2=[],this.inputValue2="",this.groupVisible=!1,this.getTags()),this.confirmLoading=!1;case 31:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.corpId=this.id||localStorage.getItem("corpId"),this.getTags()}}),r=o,c=(a("378c"),a("2877")),l=Object(c["a"])(r,i,s,!1,null,"049270fe",null);e["a"]=l.exports},"0d06":function(t,e,a){"use strict";var i=a("492c"),s=a.n(i);s.a},"186b":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,".btn-primary[data-v-2dd17ada]{margin-left:20px}[data-v-2dd17ada] .ant-tag-checkable{background-color:#fafafa;border-color:#d9d9d9;margin:0 5px}[data-v-2dd17ada] .ant-tag-checkable-checked{background-color:#1890ff}",""])},"1c4d":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,".list[data-v-021247bb]{width:100%;max-height:100%;position:absolute;overflow-y:auto}[data-v-021247bb] .ant-tabs-bar{margin:0}[data-v-021247bb] .ant-tabs-top-content{padding-bottom:0}#components-layout-demo-basic[data-v-021247bb]{height:100%}#components-layout-demo-basic .ant-layout-header[data-v-021247bb]{background:#fff;border-bottom:1px solid #e2e2e2;height:50px;min-width:835px;width:100%;line-height:50px}#components-layout-demo-basic>.ant-layout[data-v-021247bb]{margin-bottom:48px}#components-layout-demo-basic>.ant-layout[data-v-021247bb]:last-child{margin:0}#components-layout-demo-basic .ant-layout-sider[data-v-021247bb]{background:#fff;-webkit-box-flex:0!important;-ms-flex:0 0 250px!important;flex:0 0 250px!important;max-width:250px!important;min-width:250px!important;width:250px!important;border-right:1px solid #e2e2e2}#components-layout-demo-basic .ant-layout-content[data-v-021247bb]{margin:0 20px 20px 20px;min-width:835px;width:100%;padding-right:40px}.tabBtn[data-v-021247bb]{margin:0;margin-right:2px;padding:10px 16px;line-height:38px;background:#fafafa;border:1px solid #e8e8e8;border-bottom:0;border-radius:4px 4px 0 0;cursor:pointer}.activeBtn[data-v-021247bb]{color:#1890ff;background:#fff}.content-msg[data-v-021247bb]{min-width:845px;width:calc(100% - 40px);border:1px solid #ffdda6;background:#fff2db;padding:10px;margin:20px 0 0 20px;text-align:left}",""])},"20d6":function(t,e,a){"use strict";var i=a("5ca1"),s=a("0a49")(6),n="findIndex",o=!0;n in[]&&Array(1)[n]((function(){o=!1})),i(i.P+i.F*o,"Array",{findIndex:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(n)},"2c69":function(t,e,a){var i=a("8326");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("499e").default;s("5866f995",i,!0,{sourceMap:!1,shadowMode:!1})},"2e86":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,"[data-v-049270fe] .ant-tree-checkbox{float:right}[data-v-049270fe] .ant-tree-iconEle{display:none!important}[data-v-049270fe] .ant-tree-node-content-wrapper.ant-tree-node-selected{background-color:#fff!important}[data-v-049270fe] .ant-list-item{border-bottom:0;padding:0}[data-v-049270fe] .ant-list-item-meta-title{font-weight:400;line-height:32px}[data-v-049270fe] .ant-tree li span.ant-tree-checkbox{margin:4px 20px 0 2px}.content-msg[data-v-049270fe]{color:red;margin:0 20px 12px 0}.group-name[data-v-049270fe]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:calc(100% - 4px);display:inline-block;vertical-align:bottom}.tabBox[data-v-049270fe]{background:#fff;padding:10px;-webkit-box-sizing:border-box;box-sizing:border-box;margin-right:20px;border:1px solid #d8d8d8}[data-v-049270fe] .ant-tag-checkable{background-color:#fafafa;border-color:#d9d9d9;height:26px;line-height:25px}[data-v-049270fe] .ant-tag-checkable-checked{background-color:#1890ff}[data-v-049270fe] .ant-col-20{margin-left:20px;width:calc(83.33333% - 20px)}.add-tag-group[data-v-049270fe] .ant-col-20{margin-left:0;width:83.33333333%}",""])},"36bd":function(t,e,a){"use strict";var i=a("4bf8"),s=a("77f1"),n=a("9def");t.exports=function(t){var e=i(this),a=n(e.length),o=arguments.length,r=s(o>1?arguments[1]:void 0,a),c=o>2?arguments[2]:void 0,l=void 0===c?a:s(c,a);while(l>r)e[r++]=t;return e}},"378c":function(t,e,a){"use strict";var i=a("da1d"),s=a.n(i);s.a},"37d7":function(t,e,a){var i=a("186b");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("499e").default;s("1cbbd725",i,!0,{sourceMap:!1,shadowMode:!1})},"3dc0":function(t,e,a){var i=a("1c4d");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("499e").default;s("795bea30",i,!0,{sourceMap:!1,shadowMode:!1})},"492c":function(t,e,a){var i=a("8e8f");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("499e").default;s("43565ce2",i,!0,{sourceMap:!1,shadowMode:!1})},"4bef":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAABAElEQVR42s3VIY7CUBAG4LkEliC4xKJ6BA6AognXQBLCAVBYNBK3pim7zP8XBAJHSLhAZVURi+jC2+681xD4R89nZiYjIhojQRlQicYiolFQ8600EqZNAKbSpB0lyqcCBeYccIA5ihDgtO3JLdseTr7Ap9wFRx+g2HTuge8PH+AsjuBiBzZO4MsOHJzAwQ7kTiD3mcLsoX3muQcaV9s1DtnENUfssssR1i+6hRcD3GPFBaeccoEV9z7AUodoP4yxrUMs/wd26EtN0MeuBuBYDOH4LyDPWhYga1WXugpMxBhMnIBGVqD6S34B9nqvTUwaAUnNpZue689/DnuwTDUSuQJ1pL7YQ6lKkQAAAABJRU5ErkJggg=="},"62a1":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list"},[a("div",{attrs:{id:"components-layout-demo-basic"}},[t._m(0),a("div",{staticStyle:{height:"100%","padding-top":"20px"}},[a("div",{staticStyle:{padding:"0 20px"}},[a("span",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee",expression:"'chatTag-employee'"}],staticClass:"tabBtn",class:{activeBtn:1==t.tabKey},on:{click:function(e){return t.changeTabs("1")}}},[t._v("生效员工")]),a("span",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule",expression:"'chatTag-rule'"}],staticClass:"tabBtn",class:{activeBtn:2==t.tabKey},on:{click:function(e){return t.changeTabs("2")}}},[t._v("标签规则")])]),a("div",{staticStyle:{background:"#fff",margin:"0 20px 20px",padding:"12px 20px"}},[1==t.tabKey?a("EffectiveEmployee",{ref:"employee",attrs:{id:t.corpId},on:{changeCorpId:t.changeCorpId,changeScroll:t.changeScroll}}):t._e(),2==t.tabKey?a("TagRule",{ref:"tagRule",attrs:{id:t.corpId},on:{changeCorpId:t.changeCorpId,changeScroll:t.changeScroll}}):t._e()],1)])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-msg"},[a("p",{staticStyle:{"margin-bottom":"2px"}},[t._v("\n\t\t\t\t基于开启会话存档功能，当客户与员工聊天中，客户命中关键词时，该员工可自动打上客户标签，实现对客户标签的自动化管理，客户画像更智能精准。")]),a("p",{staticStyle:{"margin-bottom":"2px"}},[t._v("\n\t\t\t\t1、标签规则删除后，其关联的客户标签，在生效员工列表，该标签不再显示。")]),a("p",{staticStyle:{"margin-bottom":"0px"}},[t._v("\n\t\t\t\t2、标签规则设置的关键词，当其被修改或是删除，在生效员工列表，查看详情时，依然可看到之前所触发关键词的客户打标签的记录。")])])}],n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"content-hd"},[i("a-col",[t.corpLen>1?i("a-select",{staticStyle:{width:"170px","margin-right":"5px"},attrs:{showSearch:"",optionFilterProp:"children"},on:{change:t.handleWxId},model:{value:t.corpId,callback:function(e){t.corpId=e},expression:"corpId"}},[t._l(t.corpInfo,(function(e){return[i("a-select-option",{attrs:{value:e.corpid}},[t._v(t._s(e.corp_full_name||e.corp_name)+"\n\t\t\t\t\t")])]}))],2):t._e(),i("a-button",{staticStyle:{"min-width":"170px","margin-right":"5px"},on:{click:function(e){return t.showDepartmentList(1)}}},[t.chooseNum0>0?i("span",[t._v("已选择"+t._s(t.chooseUserNum0)+"名成员，"+t._s(t.chooseDepartmentNum0)+"个部门")]):i("span",[t._v("选择部门成员")])]),i("a-button",{staticStyle:{width:"170px","margin-right":"5px"},on:{click:t.showChooseTag}},[t.tags.length>0?i("span",[t._v("已选择"+t._s(t.tags.length)+"个标签")]):i("span",[t._v("选择标签")])]),i("a-select",{staticStyle:{width:"170px","margin-right":"5px"},attrs:{optionFilterProp:"children"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[i("a-select-option",{attrs:{value:0}},[t._v("全部状态")]),i("a-select-option",{attrs:{value:2}},[t._v("开启")]),i("a-select-option",{attrs:{value:1}},[t._v("关闭")])],1),i("a-button",{staticStyle:{margin:"0px 5px"},attrs:{type:"primary"},on:{click:t.find}},[t._v("查找")]),i("a-button",{on:{click:t.clear}},[t._v("清空")]),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-add",expression:"'chatTag-employee-add'"}],staticClass:"btn-primary",staticStyle:{float:"right"},attrs:{icon:"plus",type:"primary"},on:{click:function(e){return t.setEmployee([])}}},[t._v("\n\t\t\t\t生效员工\n\t\t\t")])],1),i("div",{staticStyle:{margin:"15px 0"}},[t._v("\n\t\t\t共\n\t\t\t"),i("span",{staticStyle:{color:"blue"}},[t._v(t._s(t.total))]),t._v("\n\t\t\t条\n\t\t")]),i("div",{staticClass:"content-bd"},[i("a-spin",{attrs:{tip:"Loading...",size:"large",spinning:t.isLoading}},[i("a-table",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-list",expression:"'chatTag-employee-list'"}],attrs:{columns:t.columns,dataSource:t.employeeList,pagination:!1,rowClassName:t.rowClassName},scopedSlots:t._u([{key:"checkedBox",fn:function(e,a,s){return i("span",{},[i("a-checkbox",{on:{click:function(e){return t.changeSelectKey(a.key)}},model:{value:t.checkBoxValue[s],callback:function(e){t.$set(t.checkBoxValue,s,e)},expression:"checkBoxValue[index]"}})],1)}},{key:"user_name",fn:function(e,s,n){return[s.avatar?i("a-avatar",{staticStyle:{float:"left"},attrs:{shape:"square",size:32,src:s.avatar}}):t._e(),s.avatar?t._e():i("img",{staticStyle:{width:"32px",height:"32px",float:"left"},attrs:{src:a("4bef")}}),i("div",{staticStyle:{float:"left",height:"32px","line-height":"32px","margin-left":"10px"}},[t._v(t._s(s.user_name))])]}},{key:"tagData",fn:function(e,a,s){return i("span",{},[0==a.tagData.length?i("span",[t._v("--")]):t._e(),t._l(a.tagData,(function(e){return i("a-popover",{attrs:{placement:"right"}},[i("span",{attrs:{slot:"content"},slot:"content"},[t._v("\n\t\t\t\t\t\t\t\t聊天中提到含\n\t\t\t\t\t\t\t\t"),t._l(e.keyword,(function(e){return i("a-tag",{staticStyle:{"margin-bottom":"5px",cursor:"pointer"},attrs:{color:"blue"}},[t._v("\n\t\t\t                        "+t._s(e)+"\n\t\t                        ")])})),t._v("\n\t\t\t\t\t\t\t\t关键词将自动打上标签\n\t\t\t\t\t\t\t")],2),i("a-tag",{staticStyle:{"margin-bottom":"5px",cursor:"pointer"},attrs:{color:"orange"}},[t._v("\n\t\t                        "+t._s(e.title)+"\n\t                        ")])],1)}))],2)}},{key:"status",fn:function(e,a,s){return i("span",{},[2==a.status?i("span",[t._v("已开启")]):t._e(),1==a.status?i("span",[t._v("已关闭")]):t._e()])}},{key:"action",fn:function(e,a,s){return i("span",{},[i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-info",expression:"'chatTag-employee-info'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.detail(a.id)}}},[t._v("详情")]),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-edit",expression:"'chatTag-employee-edit'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.edit(s)}}},[t._v("编辑")]),2==a.status?i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-open",expression:"'chatTag-employee-open'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.changeSatus(a.id,1)}}},[t._v("关闭")]):t._e(),1==a.status?i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-open",expression:"'chatTag-employee-open'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.changeSatus(a.id,2)}}},[t._v("开启")]):t._e(),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-delete",expression:"'chatTag-employee-delete'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.changeSatus(a.id,0)}}},[t._v("删除")])],1)}}])},[i("span",{attrs:{slot:"checkedBoxTitle"},slot:"checkedBoxTitle"}),i("span",{attrs:{slot:"external_num"},slot:"external_num"},[t._v("\n\t\t\t\t\t\t已打客户数\n\t\t\t\t\t\t"),i("a-tooltip",{attrs:{placement:"bottom"}},[i("template",{slot:"title"},[i("span",[t._v("只统计实际已打客户数，若打上该标签，再移除，不计入统计。")])]),i("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"question-circle"}})],2)],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"},{name:"has",rawName:"v-has",value:"chatTag-employee-list",expression:"'chatTag-employee-list'"}],staticClass:"pagination",staticStyle:{margin:"20px 15px",overflow:"hidden"}},[i("div",{staticStyle:{float:"left"}},[i("a-checkbox",{on:{click:t.batchTypeChange},model:{value:t.batchTypeValue,callback:function(e){t.batchTypeValue=e},expression:"batchTypeValue"}}),i("a-select",{staticStyle:{width:"150px",margin:"0 5px"},attrs:{optionFilterProp:"children"},on:{change:t.changeBatchType},model:{value:t.batchType,callback:function(e){t.batchType=e},expression:"batchType"}},[i("a-select-option",{attrs:{value:"0"}},[t._v("选择当前页")]),i("a-select-option",{attrs:{value:"1"}},[t._v("选择所有")])],1),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-edit",expression:"'chatTag-employee-edit'"}],staticClass:"btn-primary",attrs:{icon:"edit",disabled:0==t.selectedRowKeys.length,type:"primary"},on:{click:t.showModalWord}},[t._v("\n\t\t\t\t\t\t\t批量编辑\n\t\t\t\t\t\t")]),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-delete",expression:"'chatTag-employee-delete'"}],staticClass:"btn-primary",attrs:{icon:"delete",disabled:0==t.selectedRowKeys.length,type:"primary"},on:{click:t.deleteUser}},[t._v("\n\t\t\t\t\t\t\t批量删除\n\t\t\t\t\t\t")]),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-open",expression:"'chatTag-employee-open'"}],staticClass:"btn-primary",attrs:{icon:"unlock",disabled:0==t.selectedRowKeys.length,type:"primary"},on:{click:t.releaseFollow}},[t._v("\n\t\t\t\t\t\t\t批量开启\n\t\t\t\t\t\t")]),i("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-employee-open",expression:"'chatTag-employee-open'"}],staticClass:"btn-primary",attrs:{icon:"lock",disabled:0==t.selectedRowKeys.length,type:"primary"},on:{click:t.failure}},[t._v("\n\t\t\t\t\t\t\t批量关闭\n\t\t\t\t\t\t")])],1),i("div",{staticClass:"pagination",staticStyle:{height:"32px",float:"right"}},[i("a-pagination",{attrs:{total:t.total,showSizeChanger:"",showQuickJumper:t.quickJumper,current:t.page,pageSize:t.pageSize,pageSizeOptions:["15","30","50","100"]},on:{change:t.changePage,showSizeChange:t.showSizeChange}})],1)])],1)],1),i("a-modal",{attrs:{title:t.modalTitle,width:"666px!important"},on:{cancel:t.cancleEmployee},model:{value:t.employeeVisible,callback:function(e){t.employeeVisible=e},expression:"employeeVisible"}},[i("template",{slot:"footer"},[i("a-button",{on:{click:t.cancleEmployee}},[t._v("关闭")]),i("a-button",{attrs:{type:"primary",disabled:t.settingDisabled},on:{click:t.handleEmployee}},[t._v("确定")])],1),t.selectedKeys.length>0?i("h3",[t._v("已选择"),i("span",{staticStyle:{color:"#FF562D"}},[t._v(t._s(t.selectedKeys.length))]),t._v("名成员\n\t\t\t")]):t._e(),i("a-form",[0==t.selectedKeys.length?i("a-form-item",{attrs:{label:"企业成员","label-col":{span:4},"wrapper-col":{span:20}}},[i("a-button",{staticStyle:{"min-width":"170px","margin-right":"5px"},on:{click:function(e){return t.showDepartmentList(2)}}},[t.chooseNum1>0?i("span",[t._v("已选择"+t._s(t.chooseUserNum1)+"名成员")]):i("span",[t._v("选择部门成员")])])],1):t._e(),i("a-form-item",{attrs:{label:"聊天打标签","label-col":{span:4},"wrapper-col":{span:20}}},[i("a-button",{staticStyle:{width:"170px","margin-right":"5px"},on:{click:function(e){return t.showChooseTag1()}}},[t.addOrEditTags.length>0?i("span",[t._v("已选择"+t._s(t.addOrEditTags.length)+"个标签")]):i("span",[t._v("选择标签")])])],1),0==t.selectedKeys.length?i("a-form-item",{attrs:{label:"生效状态","label-col":{span:4},"wrapper-col":{span:20}}},[i("a-radio-group",{model:{value:t.ruleStatus,callback:function(e){t.ruleStatus=e},expression:"ruleStatus"}},[i("a-radio",{attrs:{value:2}},[t._v("\n\t\t\t\t\t\t\t开启\n\t\t\t\t\t\t")]),i("a-radio",{attrs:{value:1}},[t._v("\n\t\t\t\t\t\t\t关闭\n\t\t\t\t\t\t")])],1)],1):t._e()],1)],2),t.isLoading?t._e():i("chooseDepartment",{ref:"user",attrs:{departmentDisabled:t.departmentDisabled,id:t.corpId,show:t.showModalDepartment,chooseNum:t.chooseNum,isAudit:"2",isAuditEdit:t.isAuditEdit,isAuditUserAll:t.isAuditUserAll,noticeTitle:"只显示当前开启会话存档的企业成员。",callback:t.modalVisibleChange3}}),i("a-modal",{attrs:{title:"选择标签",width:"700px !important"},on:{cancel:t.cancleChooseTag},model:{value:t.chooseTagVisible,callback:function(e){t.chooseTagVisible=e},expression:"chooseTagVisible"}},[i("template",{slot:"footer"},[i("a-button",{on:{click:t.cancleChooseTag}},[t._v("关闭")]),i("a-button",{on:{click:t.handleChoose}},[t._v("确定")])],1),t.chooseTagVisible?i("corpChooseTag",{ref:"chooseTag",attrs:{id:t.corpId,isNotAdd:1,callback:t.modalVisibleChange,hasChoose:t.wordIds}}):t._e()],2),i("a-modal",{attrs:{title:"选择标签",width:"700px !important"},on:{cancel:t.cancleChooseTag1},model:{value:t.chooseTagVisible1,callback:function(e){t.chooseTagVisible1=e},expression:"chooseTagVisible1"}},[i("template",{slot:"footer"},[i("a-button",{on:{click:t.cancleChooseTag1}},[t._v("关闭")]),i("a-button",{on:{click:t.handleChoose1}},[t._v("确定")])],1),i("div",{staticStyle:{color:"#FF562D","margin-bottom":"10px"}},[t._v("仅显示已关联标签规则的客户标签。")]),t.chooseTagVisible1?i("corpChooseTag1",{ref:"chooseTag1",attrs:{id:t.corpId,callback:t.modalVisibleChange1,hasChoose:t.editTags}}):t._e()],2),i("a-drawer",{attrs:{destroyOnClose:!0,title:t.userName,placement:"right",closable:!1,width:"1000px!important",visible:t.detailVisible},on:{close:t.onClose}},[i("div",{staticStyle:{padding:"10px 20px"}},[t.tagRule.length>0?i("div",[i("div",{staticStyle:{margin:"10px 0"}},[t._v("打标签规则：")]),t._l(t.tagRule,(function(e){return i("p",{staticStyle:{"margin-bottom":"5px"}},[t._v("\n\t\t\t\t\t\t聊天中提到含\n\t\t\t\t\t\t"),t._l(e.keyWord,(function(e){return i("a-tag",{attrs:{color:"blue"}},[t._v(t._s(e))])})),t._v("\n\t\t\t\t\t\t关键词将自动打上标签\n\t\t\t\t\t\t"),i("a-tag",{attrs:{color:"orange"}},[t._v(t._s(e.tag_name))])],2)}))],2):t._e(),i("a-row",{staticStyle:{"background-color":"#F9F9F9","margin-top":"10px"}},[i("a-col",{staticStyle:{"text-align":"center",padding:"10px",border:"1px solid #E9E9E9"},attrs:{span:12}},[i("p",{staticStyle:{color:"#000","font-weight":"700","font-size":"34px","margin-bottom":"10px"}},[t._v(t._s(t.todayNum))]),i("p",{staticStyle:{"margin-bottom":"0px",color:"#000000a6"}},[t._v("今日打上标签的客户数")])]),i("a-col",{staticStyle:{"text-align":"center",padding:"10px",border:"1px solid #E9E9E9","border-left":"0"},attrs:{span:12}},[i("p",{staticStyle:{color:"#000","font-weight":"700","font-size":"34px","margin-bottom":"10px"}},[t._v(t._s(t.allNum))]),i("p",{staticStyle:{"margin-bottom":"0px",color:"#000000a6"}},[t._v("累计打上标签的客户数")])])],1),i("div",{staticStyle:{"background-color":"#FFFFFF",padding:"10px 10px 10px 10px"}},[i("div",{staticStyle:{height:"32px","line-height":"32px"}},[t._v("\n\t\t\t\t\t\t共\n\t\t\t\t\t\t"),i("span",{staticStyle:{color:"blue"}},[t._v(t._s(t.total1))]),t._v("\n\t\t\t\t\t\t条\n\t\t\t\t\t")]),i("a-input",{staticStyle:{width:"210px","margin-right":"10px"},attrs:{allowClear:!0,placeholder:"请输入要搜索的客户"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchStaff(e)}},model:{value:t.customName,callback:function(e){t.customName=e},expression:"customName"}}),t.tagList.length>1?i("a-select",{staticStyle:{width:"210px","margin-right":"10px"},attrs:{showSearch:"",optionFilterProp:"children",placeholder:"请选择标签"},model:{value:t.tagId,callback:function(e){t.tagId=e},expression:"tagId"}},[i("a-select-option",{attrs:{value:""}},[t._v("全部标签")]),t._l(t.tagList,(function(e){return[i("a-select-option",{attrs:{value:e.id}},[t._v(t._s(e.title))])]}))],2):t._e(),i("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.searchStaff}},[t._v("查找\n\t\t\t\t\t")]),i("a-button",{staticStyle:{"margin-right":"10px"},on:{click:t.reset}},[t._v("清空")])],1),i("div",{staticClass:"content-bd",staticStyle:{padding:"10px"}},[i("a-spin",{attrs:{tip:"Loading...",size:"large",spinning:t.isLoading1}},[i("a-table",{attrs:{columns:t.columns1,dataSource:t.customList,pagination:!1,rowClassName:t.rowClassName},scopedSlots:t._u([{key:"userInfo",fn:function(e,s,n){return i("span",{},[i("div",{staticStyle:{"white-space":"nowrap"}},[s.avatar?i("a-avatar",{staticStyle:{float:"left"},attrs:{shape:"square",size:42,src:s.avatar}}):t._e(),s.avatar?t._e():i("img",{staticStyle:{width:"42px",height:"42px"},attrs:{src:a("4bef")}}),i("span",{staticStyle:{display:"inline-block",height:"42px","line-height":"42px","margin-left":"10px"}},[t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(s.name)+"\n\t\t\t\t\t\t\t\t\t\t"),i("span",{class:null!=s.corp_name?"corp-name":"wx-name"},[null!=s.corp_name?[t._v("@"+t._s(s.corp_name))]:[t._v("@微信")]],2)])],1)])}},{key:"contentData",fn:function(e,a,s){return i("span",{},[i("span",{domProps:{innerHTML:t._s(a.content)}})])}},{key:"tagName",fn:function(e,a,s){return i("span",{},[i("a-tag",{attrs:{color:"orange"}},[t._v(t._s(a.tag_name))])],1)}}])}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.total1>0,expression:"total1 > 0"}],staticClass:"pagination",staticStyle:{width:"100%",position:"absolute",margin:"20px 0px 80px"}},[i("div",{staticClass:"pagination",staticStyle:{height:"32px",float:"right"}},[i("a-pagination",{attrs:{total:t.total1,showSizeChanger:"",showQuickJumper:t.quickJumper,current:t.page1,pageSize:t.pageSize1,pageSizeOptions:["15","30","50","100"]},on:{change:t.changePage1,showSizeChange:t.showSizeChange1}})],1)])],1)],1)],1)])],1)])},o=[],r=(a("20d6"),a("6c7b"),a("ac4d"),a("8a81"),a("ac6a"),a("96cf"),a("3b8d")),c=(a("28a5"),a("7514"),a("8ba3")),l=a("c75b"),h=a("0cfc"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"has",rawName:"v-has",value:"client-tag-list",expression:"'client-tag-list'"}],staticClass:"tabBox"},[a("a-empty",{directives:[{name:"show",rawName:"v-show",value:0==t.groupList.length,expression:"groupList.length == 0"}]},[a("span",{attrs:{slot:"description"},slot:"description"},[t._v("\n\t\t\t尚未创建标签规则，无法选择标签\n\t\t")])]),t._l(t.groupList,(function(e,i){return[t.isMore||!t.isMore&&i<5?a("a-form-item",{staticClass:"current0",attrs:{"label-col":{span:4},"wrapper-col":{span:20}}},[a("span",{staticClass:"group-name",attrs:{slot:"label"},slot:"label"},[e.name&&""!=e.name?a("a-popover",{attrs:{trigger:"hover"}},[a("span",{staticStyle:{display:"inline-block","max-width":"500px","word-wrap":"break-word","word-break":"break-all"},attrs:{slot:"content"},slot:"content"},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")]),t._v("\n\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t")]):t._e()],1),t._l(e.data,(function(s,n){return a("span",[e.disabled[n]?t._e():a("a-checkable-tag",{on:{change:function(e){return t.changeTags(s.id,i)}},model:{value:e.checked[n],callback:function(a){t.$set(e.checked,n,a)},expression:"item.checked[tagIndex]"}},[t._v("\n\t\t\t\t\t"+t._s(s.tagname)+"\n\t\t\t\t")]),e.disabled[n]&&1==t.isDisabled?a("a-button",{staticStyle:{margin:"5px","line-height":"26px !important","font-size":"12px",height:"auto !important",padding:"0 7px"},attrs:{disabled:e.disabled[n]&&1==t.isDisabled}},[t._v("\n\t\t\t\t\t"+t._s(s.tagname)+"\n\t\t\t\t")]):t._e()],1)}))],2):t._e()]})),t.groupList.length>5?a("div",{staticStyle:{"font-size":"13px",height:"26px",color:"#1890FF","text-align":"center",cursor:"pointer"},on:{click:t.showMore}},[t.isMore?t._e():[t._v("更多")],t.isMore?[t._v("收起")]:t._e(),a("a-icon",{attrs:{type:t.isMore?"arrow-up":"arrow-down"}})],2):t._e()],2)},p=[],u=(a("6762"),a("2fdb"),a("c5f6"),{name:"chooseDepartment",props:{callback:{type:Function,default:null},hasChoose:{type:Array,default:function(){}},isDisabled:{type:Number,default:0},disabledTag:{type:Array,default:function(){}},id:{type:String,default:""}},data:function(){return{corpId:"",groupList:[],tag_arr:[],tag_ids:"",group_id:[],checked:[],isMore:!1}},watch:{hasChoose:{handler:function(t){var e=this;"undefined"!=typeof t&&this.groupList.length&&(this.tag_arr=t,this.tag_ids=t.join(),this.hasChoose.map((function(t){e.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.checked[i]=!0)}))}))})),this.$forceUpdate())},deep:!0},id:{handler:function(t){""!=typeof t&&(this.corpId=t,this.getTags())},deep:!0},disabledTag:{handler:function(t){var e=this;"undefined"!=typeof t&&this.groupList.length&&(this.disabledTag.map((function(t){e.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.disabled[i]=!0)}))}))})),this.$forceUpdate())},deep:!0}},methods:{getTags:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag-keyword-rule/get-rule-tag",{corp_id:this.corpId});case 2:e=t.sent,a=e.data,0!=a.error?this.$message.error(a.error_msg):(this.groupList=a.data,this.groupList.map((function(t){t.checked=[],t.disabled=[]})),"undefined"!=typeof this.disabledTag&&this.disabledTag.length>0&&this.disabledTag.map((function(t){i.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.disabled[i]=!0)}))}))})),"undefined"!=typeof this.hasChoose&&this.hasChoose.length>0&&(this.tag_arr=this.hasChoose,this.tag_ids=this.hasChoose.join(),this.hasChoose.map((function(t){i.groupList.map((function(e){e.data.map((function(a,i){t==a.id&&(e.checked[i]=!0)}))}))})),this.$forceUpdate()));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),changeTags:function(t,e){Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)};var a=String(t);if(this.tag_arr.includes(a))this.tag_arr.remove(a);else if(this.tag_arr.length+1>20){this.$message.warning("不可选中，粉丝标签数量上限20个");for(var i=0;i<this.groupList[e].data.length;i++)this.groupList[e].data[i].id==a&&(this.groupList[e].checked[i]=!1)}else this.tag_arr.push(a);this.$forceUpdate(),this.tag_ids=this.tag_arr.join(),null!==this.callback&&"function"===typeof this.callback&&this.callback("ok",this.tag_ids)},showMore:function(){this.isMore=!this.isMore}},mounted:function(){this.corpId=this.id||localStorage.getItem("corpId"),this.getTags()}}),g=u,m=(a("acf6"),a("2877")),f=Object(m["a"])(g,d,p,!1,null,"0a52f174",null),b=f.exports,y=[{dataIndex:"checkedBox",key:"checkedBox",width:"60px",scopedSlots:{customRender:"checkedBox",title:"checkedBoxTitle"}},{title:"生效员工",dataIndex:"user_name",key:"user_name",scopedSlots:{customRender:"user_name"}},{title:"聊天自动打标签",dataIndex:"tagData",key:"tagData",width:"30%",scopedSlots:{customRender:"tagData"}},{dataIndex:"external_num",key:"external_num",scopedSlots:{title:"external_num"}},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"操作",dataIndex:"action",key:"action",width:"180px",scopedSlots:{customRender:"action"}}],v=[{title:"客户",dataIndex:"userInfo",key:"userInfo",scopedSlots:{customRender:"userInfo"}},{title:"关键词",dataIndex:"contentData",key:"contentData",width:"20%",scopedSlots:{customRender:"contentData"}},{title:"自动打标签",dataIndex:"tagName",key:"tagName",scopedSlots:{customRender:"tagName"}},{title:"添加时间",dataIndex:"add_time",key:"add_time"}],x={name:"EffectiveEmployee",components:{linkAgent:c["a"],chooseDepartment:l["a"],corpChooseTag:h["a"],corpChooseTag1:b},props:{id:{type:String,default:""}},data:function(){var t=localStorage.getItem("corpId")?localStorage.getItem("corpId"):"";return{departmentDisabled:0,isAudit:0,employeeVisible:!1,selectedKeys:[],modalTitle:"添加生效员工",settingDisabled:!1,checkBoxValue:[],batchType:"0",batchTypeValue:!1,selectedRowKeys:[],suite_id:1,corpId:t,corpInfo:[],chooseTagVisible:!1,tags:[],wordIds:[],status:0,employeeList:[],isLoading:!0,corpLen:JSON.parse(localStorage.getItem("corpArr")).length,columns:y,total:0,quickJumper:!1,page:1,pageSize:15,chooseNum0:0,chooseUserNum0:0,chooseDepartmentNum0:0,checkedList:[],chooseNum:0,showModalDepartment:!1,isUserTag:0,userType:0,isAuditEdit:0,isAuditUserAll:0,checkedList1:[],chooseNum1:0,chooseUserNum1:0,chooseDepartmentNum1:0,addOrEditTags:[],ruleStatus:2,chooseTagVisible1:!1,editTags:[],detailVisible:!1,ruleId:"",customName:"",tagId:"",tagList:[],tagRule:[],todayNum:"0",allNum:"0",userName:"",columns1:v,customList:[],total1:0,page1:1,pageSize1:15,isLoading1:!1,customAndDetaiFlag:0}},mounted:function(){var t=this;this.$store.dispatch("getCorp",(function(e){t.corpInfo=e,t.isLoading=!0,t.corpId=t.id,t.corpInfo.length>0&&(t.isAudit=t.corpInfo.find((function(e){return e.corpid==t.corpId})).isAudit),t.selectedRowKeys=[],t.getEmployeeList()}))},methods:{cancleChooseTag:function(){this.chooseTagVisible=!1},showChooseTag:function(){this.chooseTagVisible=!0,this.wordIds=JSON.parse(JSON.stringify(this.tags))},handleChoose:function(){this.tags=JSON.parse(JSON.stringify(this.wordIds)),this.chooseTagVisible=!1},modalVisibleChange:function(t,e){"ok"==t&&(this.wordIds=""==e?[]:e.split(","))},cancleChooseTag1:function(){this.chooseTagVisible1=!1},showChooseTag1:function(){this.chooseTagVisible1=!0,this.editTags=JSON.parse(JSON.stringify(this.addOrEditTags))},handleChoose1:function(){this.addOrEditTags=JSON.parse(JSON.stringify(this.editTags)),this.editTags=[],this.chooseTagVisible1=!1},modalVisibleChange1:function(t,e){"ok"==t&&(this.editTags=""==e?[]:e.split(","))},deleteUser:function(){var t=this;t.$confirm({title:"确定删除选中的员工规则?",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){t.isLoading=!0,t.changeEmployeeStatus(t.selectedRowKeys,0)}})},showDepartmentList:function(t){if(this.userType=t,1==this.userType){this.isAuditEdit=0,this.isAuditUserAll=1,this.chooseNum=this.chooseNum0,this.departmentDisabled=0;var e=[];this.checkedList.map((function(t){e.push(t.id)})),this.$refs.user.rightIdList=JSON.parse(JSON.stringify(e)),this.$refs.user.rightList=JSON.parse(JSON.stringify(this.checkedList)),this.isUserTag=0}else{this.isAuditEdit=1,this.isAuditUserAll=0,this.chooseNum=this.chooseNum1;var a=[];this.checkedList1.map((function(t){a.push(t.id)})),this.departmentDisabled=1,this.$refs.user.rightIdList=JSON.parse(JSON.stringify(a)),this.$refs.user.rightList=JSON.parse(JSON.stringify(this.checkedList1)),this.isUserTag=1}this.showModalDepartment=!0},modalVisibleChange3:function(t,e,a,i,s){"ok"==t&&(1==this.userType?(this.checkedList=s,this.chooseNum0=parseInt(a)+parseInt(i),this.chooseUserNum0=a,this.chooseDepartmentNum0=i):(this.checkedList1=s,this.chooseNum1=parseInt(a)+parseInt(i),this.chooseUserNum1=a,this.chooseDepartmentNum1=i)),this.showModalDepartment=!1},showModalWord:function(){this.modalTitle="批量编辑生效员工",this.selectedKeys=JSON.parse(JSON.stringify(this.selectedRowKeys)),this.addOrEditTags=[],this.employeeVisible=!0},handleEmployee:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n,o,r,c,l,h,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.settingDisabled=!0,e="",a={},0!=this.addOrEditTags.length){t.next=7;break}return this.$message.warning("请选择标签！"),this.settingDisabled=!1,t.abrupt("return",!1);case 7:if(0!=this.selectedKeys.length){t.next=36;break}if(e="work-tag-keyword-rule/user-tag-add",0!=this.checkedList1.length){t.next=13;break}return this.$message.warning("请选择企业成员！"),this.settingDisabled=!1,t.abrupt("return",!1);case 13:for(i=[],s=!0,n=!1,o=void 0,t.prev=17,r=this.checkedList1[Symbol.iterator]();!(s=(c=r.next()).done);s=!0)l=c.value,i.push(l.id);t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](17),n=!0,o=t.t0;case 25:t.prev=25,t.prev=26,s||null==r.return||r.return();case 28:if(t.prev=28,!n){t.next=31;break}throw o;case 31:return t.finish(28);case 32:return t.finish(25);case 33:a={corp_id:this.corpId,user_ids:i,tag_ids:this.addOrEditTags,status:this.ruleStatus},t.next=38;break;case 36:e="work-tag-keyword-rule/user-tag-update",a={ids:this.selectedKeys,tag_ids:this.addOrEditTags};case 38:return t.next=40,this.axios.post(e,a);case 40:h=t.sent,d=h.data,0!=d.error?(this.settingDisabled=!1,this.$message.error(d.error_msg)):(this.settingDisabled=!1,this.addOrEditTags=[],this.selectedRowKeys=[],0==this.selectedKeys.length?(this.$message.success("添加成功！"),this.clear()):(this.$message.success("修改成功！"),this.getEmployeeList(this.page,this.pageSize)),this.selectedKeys=[],this.employeeVisible=!1);case 43:case"end":return t.stop()}}),t,this,[[17,21,25,33],[26,,28,32]])})));function e(){return t.apply(this,arguments)}return e}(),cancleEmployee:function(){this.checkedList1=[],this.chooseNum1=0,this.chooseUserNum1=0,this.chooseDepartmentNum1=0,this.addOrEditTags=[],this.ruleStatus=2,this.employeeVisible=!1},changeSelectKey:function(t){for(var e=0;e<this.selectedRowKeys.length;e++)if(t==this.selectedRowKeys[e])return this.selectedRowKeys.splice(e,1),this.setBox(),!1;this.selectedRowKeys.push(t),this.setBox()},batchTypeChange:function(){this.batchTypeValue?(0==this.batchType?(this.removeKey(this.employeeList),this.setCheckedBox(this.employeeList)):1==this.batchType&&(this.selectedRowKeys=[],this.setBox()),this.batchTypeValue=!1):(0==this.batchType?(this.addKey(this.employeeList),this.setCheckedBox(this.employeeList)):1==this.batchType&&(this.selectedRowKeys=JSON.parse(JSON.stringify(this.employeeKeys)),this.setBox()),this.batchTypeValue=!0)},setBox:function(){this.setCheckedBox(this.employeeList)},setCheckedBox:function(t){this.checkBoxValue=new Array(t.length),this.checkBoxValue.fill(!1);for(var e=0;e<t.length;e++)for(var a=0;a<this.selectedRowKeys.length;a++)t[e].key==this.selectedRowKeys[a]&&(this.checkBoxValue[e]=!0);if(0==this.batchType){this.batchTypeValue=!0;for(var i=0;i<this.checkBoxValue.length;i++)this.checkBoxValue[i]||(this.batchTypeValue=!1)}else this.selectedRowKeys.length==this.employeeKeys.length&&0!=this.employeeKeys.length?this.batchTypeValue=!0:this.batchTypeValue=!1;0==t.length&&(this.batchTypeValue=!1)},changeBatchType:function(t){this.batchType=t,this.batchTypeValue?(0==this.batchType&&(this.selectedRowKeys=[]),this.batchTypeValue=!1,this.batchTypeChange()):this.setBox()},addKey:function(t){for(var e=this,a=function(a){var i=e.selectedRowKeys.findIndex((function(e){return e===t[a].key}));-1==i&&e.selectedRowKeys.push(t[a].key)},i=0;i<t.length;i++)a(i)},removeKey:function(t){for(var e=this,a=function(a){var i=e.selectedRowKeys.findIndex((function(e){return e===t[a].key}));-1!=i&&e.selectedRowKeys.splice(i,1)},i=0;i<t.length;i++)a(i)},handleWxId:function(t){var e=this;this.corpId=t,this.corpInfo.length>0&&(this.isAudit=this.corpInfo.find((function(t){return t.corpid==e.corpId})).isAudit),this.tags=[],this.checkedList=[],this.chooseNum0=0,this.chooseUserNum0=0,this.chooseDepartmentNum0=0,this.$emit("changeCorpId",this.corpId)},rowClassName:function(t,e){var a="dark-row";return e%2===0&&(a="light-row"),a},find:function(){this.isLoading=!0,this.getEmployeeList()},setEmployee:function(t){if(1!=this.isAudit)return this.$message.destroy(),this.$message.warning("需要先开启【会话存档】功能，开启后才能正常设置员工违规",2),!1;this.chooseNum1=0,this.chooseUserNum1=0,this.chooseDepartmentNum1=0,this.checkedList1=[],this.modalTitle="添加生效员工",this.selectedKeys=t,this.addOrEditTags=[],this.ruleStatus=2,this.employeeVisible=!0},clear:function(){this.corpId=localStorage.getItem("corpId")?localStorage.getItem("corpId"):"",this.isLoading=!0,this.checkedList=[],this.chooseNum0=0,this.chooseUserNum0=0,this.chooseDepartmentNum0=0,this.tags=[],this.status=0,this.page=1,this.pageSize=15,this.getEmployeeList()},getEmployeeList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n,o,r,c,l,h,d,p=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(e=p.length>0&&void 0!==p[0]?p[0]:1,a=p.length>1&&void 0!==p[1]?p[1]:this.pageSize,this.isLoading=!0,i=[],s=!0,n=!1,o=void 0,t.prev=7,r=this.checkedList[Symbol.iterator]();!(s=(c=r.next()).done);s=!0)l=c.value,i.push(l.id);t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](7),n=!0,o=t.t0;case 15:t.prev=15,t.prev=16,s||null==r.return||r.return();case 18:if(t.prev=18,!n){t.next=21;break}throw o;case 21:return t.finish(18);case 22:return t.finish(15);case 23:return t.next=25,this.axios.post("work-tag-keyword-rule/user-list",{corp_id:this.corpId,status:this.status,user_id:i,tag_ids:this.tags,page:e,pageSize:a});case 25:h=t.sent,d=h.data,0!=d.error?(this.isLoading=!1,this.$message.error(d.error_msg)):(this.employeeList=d.data.userData,this.employeeKeys=d.data.keys,this.setCheckedBox(this.employeeList),this.isLoading=!1,this.total=parseInt(d.data.count),this.page=e,this.pageSize=a,this.quickJumper=this.total>this.pageSize);case 28:case"end":return t.stop()}}),t,this,[[7,11,15,23],[16,,18,22]])})));function e(){return t.apply(this,arguments)}return e}(),edit:function(t){this.modalTitle="编辑生效员工",this.selectedKeys=[this.employeeList[t].key],this.addOrEditTags=[];var e=!0,a=!1,i=void 0;try{for(var s,n=this.employeeList[t].tagData[Symbol.iterator]();!(e=(s=n.next()).done);e=!0){var o=s.value;this.addOrEditTags.push(o.id)}}catch(r){a=!0,i=r}finally{try{e||null==n.return||n.return()}finally{if(a)throw i}}this.employeeVisible=!0},releaseFollow:function(){var t=this;t.$confirm({title:"确定开启选中的员工规则?",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){t.isLoading=!0,t.changeEmployeeStatus(t.selectedRowKeys,2)}})},failure:function(){var t=this;t.$confirm({title:"确定关闭选中的员工规则?",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){t.isLoading=!0,t.changeEmployeeStatus(t.selectedRowKeys,1)}})},changeSatus:function(t,e){var a=this,i="";i=2==e?"开启":1==e?"关闭":"删除",a.$confirm({title:"确定"+i+"该员工规则？",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){a.isLoading=!0;var i=[];i.push(t),a.changeEmployeeStatus(i,e)}})},changeEmployeeStatus:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag-keyword-rule/user-change-status",{corp_id:localStorage.getItem("corpId"),ids:e,status:a});case 2:i=t.sent,s=i.data,0!=s.error?(this.isLoading=!1,this.$message.error(s.error_msg)):(this.selectedRowKeys=[],this.getEmployeeList(this.page,this.pageSize));case 5:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),changePage:function(t,e){this.isLoading=!0,this.getEmployeeList(t,e)},showSizeChange:function(t,e){this.isLoading=!0,this.getEmployeeList(1,e)},detail:function(t){this.ruleId=t,this.detailVisible=!0,this.customAndDetaiFlag=0,this.getCustomList(),this.getTagDetail()},onClose:function(){this.customAndDetaiFlag=0,this.detailVisible=!1,this.customList=[],this.customName="",this.tagId=[],this.tagList=[]},searchStaff:function(){this.getCustomList()},getTagDetail:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag-keyword-rule/user-tag-detail",{rule_id:this.ruleId});case 2:e=t.sent,a=e.data,0!=a.error?this.$message.error(a.error_msg):(this.tagList=a.data.tagData,this.tagRule=a.data.ruleData,this.todayNum=a.data.today_num,this.allNum=a.data.total,this.userName=a.data.user_name,this.customAndDetaiFlag++,this.customAndDetaiFlag>=2&&(this.isLoading1=!1));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getCustomList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:1,a=n.length>1&&void 0!==n[1]?n[1]:this.pageSize1,this.isLoading1=!0,t.next=5,this.axios.post("work-tag-keyword-rule/user-tag-custom",{rule_id:this.ruleId,name:this.customName,tag_id:this.tagId,page:e,pageSize:a});case 5:i=t.sent,s=i.data,0!=s.error?(this.isLoading1=!1,this.$message.error(s.error_msg)):(this.customList=s.data.externalData,this.total1=parseInt(s.data.count),this.page1=e,this.pageSize1=a,this.customAndDetaiFlag++,this.customAndDetaiFlag>=2&&(this.isLoading1=!1));case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),reset:function(){this.customName="",this.tagId=[],this.getCustomList()},changePage1:function(t,e){this.isLoading=!0,this.getCustomList(t,e),this.$emit("changeScroll")},showSizeChange1:function(t,e){this.isLoading=!0,this.getCustomList(1,e)}}},w=x,k=(a("0d06"),Object(m["a"])(w,n,o,!1,null,"d6eb7ff8",null)),_=k.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-hd"},[a("a-col",[t.corpLen>1?a("a-select",{staticStyle:{width:"170px","margin-right":"5px"},attrs:{showSearch:"",optionFilterProp:"children"},on:{change:t.handleWxId},model:{value:t.corpId,callback:function(e){t.corpId=e},expression:"corpId"}},[t._l(t.corpInfo,(function(e){return[a("a-select-option",{attrs:{value:e.corpid}},[t._v(t._s(e.corp_full_name||e.corp_name)+"\n\t\t\t\t\t")])]}))],2):t._e(),a("a-button",{staticStyle:{width:"170px","margin-right":"5px"},on:{click:function(e){return t.showChooseTag(-1)}}},[t.tags.length>0?a("span",[t._v("已选择"+t._s(t.tags.length)+"个标签")]):a("span",[t._v("选择标签")])]),a("a-button",{staticStyle:{margin:"0px 5px"},attrs:{type:"primary"},on:{click:t.find}},[t._v("查找")]),a("a-button",{on:{click:t.clear}},[t._v("清空")]),a("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule-add",expression:"'chatTag-rule-add'"}],staticClass:"btn-primary",staticStyle:{float:"right"},attrs:{icon:"plus",type:"primary"},on:{click:t.addTagRules}},[t._v("\n\t\t\t\t添加标签规则\n\t\t\t")])],1),a("div",{staticStyle:{margin:"15px 0"}},[t._v("\n\t\t\t共\n\t\t\t"),a("span",{staticStyle:{color:"blue"}},[t._v(t._s(t.total))]),t._v("\n\t\t\t条\n\t\t")]),a("div",{staticClass:"content-bd"},[a("a-spin",{attrs:{tip:"Loading...",size:"large",spinning:t.isLoading}},[a("a-table",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule-list",expression:"'chatTag-rule-list'"}],attrs:{columns:t.columns,dataSource:t.tagRuleList,pagination:!1,rowClassName:t.rowClassName},scopedSlots:t._u([{key:"checkedBox",fn:function(e,i,s){return a("span",{},[a("a-checkbox",{on:{click:function(e){return t.changeSelectKey(i.key)}},model:{value:t.checkBoxValue[s],callback:function(e){t.$set(t.checkBoxValue,s,e)},expression:"checkBoxValue[index]"}})],1)}},{key:"tagData",fn:function(e,i,s){return a("span",{},[0==i.tagData.length?a("span",[t._v("--")]):t._e(),t._l(i.tagData,(function(e){return a("a-tag",{staticStyle:{"margin-bottom":"5px",cursor:"pointer"},attrs:{color:"orange"}},[t._v("\n\t\t\t                    "+t._s(e.title)+"\n\t\t                    ")])}))],2)}},{key:"keyword",fn:function(e,i,s){return a("span",{},[0==i.keyword.length?a("span",[t._v("--")]):t._e(),a("span",[t._v("聊天中提到含 ")]),t._l(i.keyword,(function(e){return a("a-tag",{staticStyle:{cursor:"pointer"},attrs:{color:"blue"}},[t._v("\n\t\t                    "+t._s(e)+"\n\t                    ")])})),a("span",[t._v("关键词将自动打上标签")])],2)}},{key:"userInfo",fn:function(e,a,i){return[t._v("\n\t\t\t\t\t\t"+t._s(a.user_num)+"个\n\t\t\t\t\t")]}},{key:"action",fn:function(e,i,s){return a("span",{},[a("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule-edit",expression:"'chatTag-rule-edit'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.edit(s)}}},[t._v("编辑")]),a("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule-delete",expression:"'chatTag-rule-delete'"}],staticStyle:{margin:"0 5px 5px 0"},on:{click:function(e){return t.changeStatus(i.id,0)}}},[t._v("删除")])],1)}}])},[a("span",{attrs:{slot:"checkedBoxTitle"},slot:"checkedBoxTitle"})]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"},{name:"has",rawName:"v-has",value:"chatTag-rule-list",expression:"'chatTag-rule-list'"}],staticClass:"pagination",staticStyle:{margin:"20px 15px",overflow:"hidden"}},[a("div",{staticStyle:{float:"left"}},[a("a-checkbox",{on:{click:t.batchTypeChange},model:{value:t.batchTypeValue,callback:function(e){t.batchTypeValue=e},expression:"batchTypeValue"}}),a("a-select",{staticStyle:{width:"150px",margin:"0 5px"},attrs:{optionFilterProp:"children"},on:{change:t.changeBatchType},model:{value:t.batchType,callback:function(e){t.batchType=e},expression:"batchType"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("选择当前页")]),a("a-select-option",{attrs:{value:"1"}},[t._v("选择所有")])],1),a("a-button",{directives:[{name:"has",rawName:"v-has",value:"chatTag-rule-delete",expression:"'chatTag-rule-delete'"}],staticClass:"btn-primary",attrs:{icon:"delete",disabled:0==t.selectedRowKeys.length,type:"primary"},on:{click:t.deleteUser}},[t._v("\n\t\t\t\t\t\t\t批量删除\n\t\t\t\t\t\t")])],1),a("div",{staticClass:"pagination",staticStyle:{height:"32px",float:"right"}},[a("a-pagination",{attrs:{total:t.total,showSizeChanger:"",showQuickJumper:t.quickJumper,current:t.page,pageSize:t.pageSize,pageSizeOptions:["15","30","50","100"]},on:{change:t.changePage,showSizeChange:t.showSizeChange}})],1)])],1)],1),a("a-modal",{attrs:{title:"选择标签",zIndex:99,width:"700px !important"},on:{cancel:t.cancleChooseTag},model:{value:t.chooseTagVisible,callback:function(e){t.chooseTagVisible=e},expression:"chooseTagVisible"}},[a("template",{slot:"footer"},[a("a-button",{on:{click:t.cancleChooseTag}},[t._v("关闭")]),a("a-button",{on:{click:t.handleChoose}},[t._v("确定")])],1),t.chooseTagVisible?a("corpChooseTag",{ref:"chooseTag",attrs:{isNotAdd:t.isNotAdd,id:t.corpId,disabledTag:t.disabledTag,isDisabled:1,callback:t.modalVisibleChange,hasChoose:t.wordIds}}):t._e()],2),a("a-modal",{attrs:{title:"添加标签规则",zIndex:88,width:"700px !important"},on:{cancel:t.cancleRule},model:{value:t.ruleVisible,callback:function(e){t.ruleVisible=e},expression:"ruleVisible"}},[a("template",{slot:"footer"},[a("a-button",{on:{click:t.cancleRule}},[t._v("关闭")]),a("a-button",{attrs:{type:"primary",disabled:t.createRule},on:{click:t.handleSubmit}},[t._v("确定")])],1),a("a-form",t._l(t.tagRules,(function(e,i){return a("div",{staticStyle:{"margin-bottom":"10px","border-bottom":"1px solid #F5F5F5"}},[a("a-form-item",{attrs:{label:"聊天打标签","label-col":{span:6},"wrapper-col":{span:16}}},[a("a-button",{staticStyle:{width:"170px","margin-right":"5px"},on:{click:function(e){return t.showChooseTag(i)}}},[e.tags.length>0?a("span",[t._v("已选择"+t._s(e.tags.length)+"个标签")]):a("span",[t._v("选择标签")])])],1),a("a-form-item",{attrs:{label:"触发打标签规则","label-col":{span:6},"wrapper-col":{span:16}}},[a("span",{staticStyle:{display:"inline-block","vertical-align":"text-top","line-height":"20px"}},[t._v("聊天中包含以下关键词则自动打上标签。同时添加多个关键词，请用“空格隔开”")]),a("a-input",{attrs:{placeholder:"请输入关键词"},model:{value:e.words,callback:function(a){t.$set(e,"words",a)},expression:"tag.words"}})],1),a("div",{staticStyle:{"text-align":"center",margin:"10px"}},[t.tagRules.length>1?a("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"danger"},on:{click:function(e){return t.deleteTagRule(i)}}},[t._v("删除\n\t\t\t\t\t\t")]):t._e(),i==t.tagRules.length-1?a("a-button",{attrs:{type:"primary"},on:{click:t.addTagRule}},[t._v("添加")]):t._e()],1)],1)})),0)],2),a("a-modal",{attrs:{title:"编辑标签规则",zIndex:88,width:"700px !important"},on:{cancel:t.cancleEdit},model:{value:t.editRuleVisible,callback:function(e){t.editRuleVisible=e},expression:"editRuleVisible"}},[a("template",{slot:"footer"},[a("a-button",{on:{click:t.cancleEdit}},[t._v("关闭")]),a("a-button",{attrs:{type:"primary",disabled:t.editRule},on:{click:t.handleEdit}},[t._v("确定")])],1),a("a-form",[a("a-form-item",{attrs:{label:"聊天打标签","label-col":{span:6},"wrapper-col":{span:16}}},[a("a-button",{staticStyle:{width:"170px","margin-right":"5px"},on:{click:function(e){return t.showChooseTag(-2)}}},[t.editTags.length>0?a("span",[t._v("已选择"+t._s(t.editTags.length)+"个标签")]):a("span",[t._v("选择标签")])])],1),a("a-form-item",{attrs:{label:"触发打标签规则","label-col":{span:6},"wrapper-col":{span:16}}},[a("span",{staticStyle:{display:"inline-block","vertical-align":"text-top","line-height":"20px"}},[t._v("聊天中包含以下关键词则自动打上标签。同时添加多个关键词，请用“空格隔开”")]),a("a-input",{attrs:{placeholder:"请输入关键词"},model:{value:t.editWords,callback:function(e){t.editWords=e},expression:"editWords"}})],1)],1)],2)],1)},S=[],L=[{dataIndex:"checkedBox",key:"checkedBox",width:"60px",scopedSlots:{customRender:"checkedBox",title:"checkedBoxTitle"}},{title:"标签规则",dataIndex:"keyword",key:"keyword",scopedSlots:{customRender:"keyword"}},{title:"聊天打标签",dataIndex:"tagData",key:"tagData",scopedSlots:{customRender:"tagData"}},{title:"生效员工",dataIndex:"userInfo",key:"userInfo",scopedSlots:{customRender:"userInfo"}},{title:"操作",dataIndex:"action",key:"action",width:"16%",scopedSlots:{customRender:"action"}}],I={name:"TagRule",props:{id:{type:String,default:""}},components:{linkAgent:c["a"],corpChooseTag:h["a"]},data:function(){return{tagIdData:[],editRule:!1,editRuleId:"",editRuleVisible:!1,editWords:"",editTags:[],ruleVisible:!1,createRule:!1,tagRules:[],wordIds:[],disabledTag:[],checkBoxValue:[],batchType:"0",batchTypeValue:!1,selectedRowKeys:[],suite_id:1,corpId:"",corpInfo:[],tags:[],tagRuleList:[],isLoading:!0,corpLen:JSON.parse(localStorage.getItem("corpArr")).length,columns:L,total:0,quickJumper:!1,page:1,pageSize:15,chooseTagVisible:!1,isNotAdd:0,tagListIndex:-1}},mounted:function(){var t=this;this.$store.dispatch("getCorp",(function(e){t.corpInfo=e,t.isLoading=!0,t.selectedRowKeys=[],t.corpId=t.id,t.getTagRuleList()}))},methods:{cancleChooseTag:function(){this.chooseTagVisible=!1},showChooseTag:function(t){if(-1==t)this.isNotAdd=1,this.disabledTag=[],this.tagListIndex=-1,this.chooseTagVisible=!0,this.wordIds=JSON.parse(JSON.stringify(this.tags));else if(-2==t)this.isNotAdd=0,this.tagListIndex=-2,this.chooseTagVisible=!0,this.wordIds=JSON.parse(JSON.stringify(this.editTags));else{this.isNotAdd=0,this.disabledTag=[];for(var e=0;e<this.tagRules.length;e++)e!=t&&(this.disabledTag=this.disabledTag.concat(this.tagRules[e].tags));this.disabledTag=this.disabledTag.concat(this.tagIdData),this.tagListIndex=t,this.wordIds=JSON.parse(JSON.stringify(this.tagRules[t].tags))}this.chooseTagVisible=!0},handleChoose:function(){-1==this.tagListIndex?this.tags=JSON.parse(JSON.stringify(this.wordIds)):-2==this.tagListIndex?this.editTags=JSON.parse(JSON.stringify(this.wordIds)):this.tagRules[this.tagListIndex].tags=JSON.parse(JSON.stringify(this.wordIds)),this.chooseTagVisible=!1},modalVisibleChange:function(t,e){"ok"==t&&(this.wordIds=""==e?[]:e.split(","))},changeSelectKey:function(t){for(var e=0;e<this.selectedRowKeys.length;e++)if(t==this.selectedRowKeys[e])return this.selectedRowKeys.splice(e,1),this.setBox(),!1;this.selectedRowKeys.push(t),this.setBox()},batchTypeChange:function(){this.batchTypeValue?(0==this.batchType?(this.removeKey(this.tagRuleList),this.setCheckedBox(this.tagRuleList)):1==this.batchType&&(this.selectedRowKeys=[],this.setBox()),this.batchTypeValue=!1):(0==this.batchType?(this.addKey(this.tagRuleList),this.setCheckedBox(this.tagRuleList)):1==this.batchType&&(this.selectedRowKeys=JSON.parse(JSON.stringify(this.tagRuleKeys)),this.setBox()),this.batchTypeValue=!0)},setBox:function(){this.setCheckedBox(this.tagRuleList)},setCheckedBox:function(t){this.checkBoxValue=new Array(t.length),this.checkBoxValue.fill(!1);for(var e=0;e<t.length;e++)for(var a=0;a<this.selectedRowKeys.length;a++)t[e].key==this.selectedRowKeys[a]&&(this.checkBoxValue[e]=!0);if(0==this.batchType){this.batchTypeValue=!0;for(var i=0;i<this.checkBoxValue.length;i++)this.checkBoxValue[i]||(this.batchTypeValue=!1)}else this.selectedRowKeys.length==this.tagRuleKeys.length&&0!=this.tagRuleKeys.length?this.batchTypeValue=!0:this.batchTypeValue=!1;0==t.length&&(this.batchTypeValue=!1)},changeBatchType:function(t){this.batchType=t,this.batchTypeValue?(0==this.batchType&&(this.selectedRowKeys=[]),this.batchTypeValue=!1,this.batchTypeChange()):this.setBox()},addKey:function(t){for(var e=this,a=function(a){var i=e.selectedRowKeys.findIndex((function(e){return e===t[a].key}));-1==i&&e.selectedRowKeys.push(t[a].key)},i=0;i<t.length;i++)a(i)},removeKey:function(t){for(var e=this,a=function(a){var i=e.selectedRowKeys.findIndex((function(e){return e===t[a].key}));-1!=i&&e.selectedRowKeys.splice(i,1)},i=0;i<t.length;i++)a(i)},handleWxId:function(t){this.corpId=t,this.tags=[],this.$emit("changeCorpId",this.corpId)},rowClassName:function(t,e){var a="dark-row";return e%2===0&&(a="light-row"),a},find:function(){this.isLoading=!0,this.getTagRuleList()},addTagRules:function(){this.tagRules=[{words:"",tags:[]}],this.ruleVisible=!0},addTagRule:function(){this.tagRules.push({words:"",tags:[]})},deleteTagRule:function(t){this.tagRules.splice(t,1)},handleSubmit:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n,o,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.createRule=!0,e=!0,a=!1,i=void 0,t.prev=4,s=this.tagRules[Symbol.iterator]();case 6:if(e=(n=s.next()).done){t.next=19;break}if(o=n.value,0!=o.tags.length){t.next=12;break}return this.$message.warning("请检查标签"),this.createRule=!1,t.abrupt("return",!1);case 12:if(""!=o.words){t.next=16;break}return this.$message.warning("请检查关键词"),this.createRule=!1,t.abrupt("return",!1);case 16:e=!0,t.next=6;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](4),a=!0,i=t.t0;case 25:t.prev=25,t.prev=26,e||null==s.return||s.return();case 28:if(t.prev=28,!a){t.next=31;break}throw i;case 31:return t.finish(28);case 32:return t.finish(25);case 33:return t.next=35,this.axios.post("work-tag-keyword-rule/add",{corp_id:this.corpId,tag_rules:this.tagRules});case 35:r=t.sent,c=r.data,0!=c.error?(this.isLoading=!1,this.createRule=!1,this.$message.error(c.error_msg)):(this.ruleVisible=!1,this.createRule=!1,this.clear());case 38:case"end":return t.stop()}}),t,this,[[4,21,25,33],[26,,28,32]])})));function e(){return t.apply(this,arguments)}return e}(),cancleRule:function(){this.ruleVisible=!1,this.tagRules=[]},clear:function(){this.corpId=localStorage.getItem("corpId")?localStorage.getItem("corpId"):"",this.isLoading=!0,this.tags=[],this.page=1,this.pageSize=15,this.getTagRuleList()},getTagRuleList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:1,a=n.length>1&&void 0!==n[1]?n[1]:this.pageSize,this.isLoading=!0,t.next=5,this.axios.post("work-tag-keyword-rule/list",{corp_id:this.corpId,tag_ids:this.tags,page:e,pageSize:a});case 5:i=t.sent,s=i.data,0!=s.error?(this.isLoading=!1,this.$message.error(s.error_msg)):(this.tagIdData=s.data.tagIdData,this.tagRuleList=s.data.ruleData,this.tagRuleKeys=s.data.keys,this.setCheckedBox(this.tagRuleList),this.isLoading=!1,this.total=parseInt(s.data.count),this.page=e,this.pageSize=a,this.quickJumper=this.total>this.pageSize);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),edit:function(t){var e=this;this.editRuleId=this.tagRuleList[t].id,this.disabledTag=JSON.parse(JSON.stringify(this.tagIdData)),this.editWords="";for(var a=0;a<this.tagRuleList[t].keyword.length;a++)this.editWords+=this.tagRuleList[t].keyword[a],a!=this.tagRuleList[t].keyword.length-1&&(this.editWords+=" ");this.editTags=[];for(var i=function(a){e.editTags.push(e.tagRuleList[t].tagData[a].id),e.disabledTag.splice(e.disabledTag.findIndex((function(i){return i==e.tagRuleList[t].tagData[a].id})),1)},s=0;s<this.tagRuleList[t].tagData.length;s++)i(s);this.editRuleVisible=!0},handleEdit:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.editRule=!0,0!=this.editTags.length){t.next=5;break}return this.$message.warning("请检查标签"),this.editRule=!1,t.abrupt("return",!1);case 5:if(""!=this.editWords){t.next=9;break}return this.$message.warning("请检查关键词"),this.editRule=!1,t.abrupt("return",!1);case 9:return t.next=11,this.axios.post("work-tag-keyword-rule/update",{id:this.editRuleId,tags:this.editTags,words:this.editWords});case 11:e=t.sent,a=e.data,0!=a.error?(this.isLoading=!1,this.$message.error(a.error_msg)):(this.selectedRowKeys=[],this.editRuleVisible=!1,this.editRule=!1,this.getTagRuleList(this.page,this.pageSize));case 14:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),cancleEdit:function(){this.editWords="",this.editTags=[],this.disabledTag=[],this.editRuleId="",this.editRuleVisible=!1},deleteUser:function(){var t=this;t.$confirm({title:"确定删除选中的标签规则?",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){t.isLoading=!0,t.changeRuleStatus(t.selectedRowKeys,0)}})},changeStatus:function(t,e){var a=this,i="";i=2==e?"开启":1==e?"关闭":"删除",a.$confirm({title:"确定"+i+"该标签规则？",okText:"确定",okType:"primary",cancelText:"取消",onOk:function(){a.isLoading=!0;var i=[];i.push(t),a.changeRuleStatus(i,e)}})},changeRuleStatus:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-tag-keyword-rule/change-status",{corp_id:this.corpId,ids:e,status:a});case 2:i=t.sent,s=i.data,0!=s.error?(this.isLoading=!1,this.$message.error(s.error_msg)):(this.selectedRowKeys=[],this.getTagRuleList(this.page,this.pageSize));case 5:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),changePage:function(t,e){this.isLoading=!0,this.getTagRuleList(t,e),this.$emit("changeScroll")},showSizeChange:function(t,e){this.isLoading=!0,this.getTagRuleList(1,e)}}},R=I,N=(a("eb31"),Object(m["a"])(R,T,S,!1,null,"2dd17ada",null)),C=N.exports,A={name:"archiveChat",components:{TagRule:C,EffectiveEmployee:_},data:function(){return{tabKey:1,tabindex:3,corpId:localStorage.getItem("corpId")}},created:function(){},methods:{changeTabs:function(t){this.tabKey=t},changeCorpId:function(t){this.corpId=t},changeScroll:function(){document.getElementsByClassName("list")[0].scrollTo(0,0)}}},V=A,O=(a("c472"),Object(m["a"])(V,i,s,!1,null,"021247bb",null));e["default"]=O.exports},"6c7b":function(t,e,a){var i=a("5ca1");i(i.P,"Array",{fill:a("36bd")}),a("9c6c")("fill")},8326:function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,"[data-v-0a52f174] .ant-tree-checkbox{float:right}[data-v-0a52f174] .ant-tree-iconEle{display:none!important}[data-v-0a52f174] .ant-tree-node-content-wrapper.ant-tree-node-selected{background-color:#fff!important}[data-v-0a52f174] .ant-list-item{border-bottom:0;padding:0}[data-v-0a52f174] .ant-list-item-meta-title{font-weight:400;line-height:32px}[data-v-0a52f174] .ant-tree li span.ant-tree-checkbox{margin:4px 20px 0 2px}.content-msg[data-v-0a52f174]{color:red;margin:0 20px 12px 0}.group-name[data-v-0a52f174]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:calc(100% - 4px);display:inline-block;vertical-align:bottom}.tabBox[data-v-0a52f174]{background:#fff;padding:10px;-webkit-box-sizing:border-box;box-sizing:border-box;margin-right:20px;border:1px solid #d8d8d8}",""])},"8ba3":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-modal",{attrs:{title:"关联应用",width:"600px"},on:{ok:t.addAgentOk,cancel:t.addAgentCancel},model:{value:t.showAddAgentModal,callback:function(e){t.showAddAgentModal=e},expression:"showAddAgentModal"}},[a("div",{staticClass:"content-msg",staticStyle:{"margin-top":"0","margin-bottom":"15px"}},[a("p",{staticStyle:{"margin-bottom":"5px"}},[t._v("\n\t\t\t\t请登录企业微信官方后台，在应用管理-应用-自建应用，找到您已建好应用的AgentId和Secret，并复制到下面的输入框。提交后将该应用添加到本系统里。\n\t\t\t")]),a("p",{staticStyle:{height:"20px","line-height":"20px","margin-bottom":"2px"}},[t._v("1、前往"),a("a",{attrs:{target:"_blank",href:"https://work.weixin.qq.com/wework_admin/loginpage_wx?from=myhome_baidu"}},[t._v("\n\t\t\t\t企业微信后台")]),t._v("创建自建应用。"),a("a",{attrs:{target:"_blank",href:"https://support.qq.com/products/104790/faqs/63937"}},[t._v("\n\t\t\t\t教程")])]),a("p",{staticStyle:{"line-height":"20px",height:"20px","margin-bottom":"0px"}},[t._v("\n\t\t\t\t2、选择此应用，请确认已设置过应用的可信域名。\n\t\t\t\t"),a("a",{staticClass:"el-link el-link--primary",attrs:{href:t.$store.state.commonUrl+"/upload/slider.png",target:"_blank"}},[a("span",{staticClass:"el-link--inner"},[t._v("查看图示")])])])]),t.agentList.length>0?a("a-form-item",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[a("template",{slot:"label"},[t._v("选择应用\n\t\t\t")]),a("a-radio-group",{model:{value:t.agentType,callback:function(e){t.agentType=e},expression:"agentType"}},[a("a-radio",{attrs:{value:1}},[t._v("选择已有")]),a("a-radio",{attrs:{value:2}},[t._v("新建应用")])],1)],2):t._e(),1==t.agentType?[a("a-select",{staticStyle:{width:"200px","margin-left":"90px"},attrs:{showSearch:"",optionFilterProp:"children"},model:{value:t.agent_id,callback:function(e){t.agent_id=e},expression:"agent_id"}},[t._l(t.agentList,(function(e){return[a("a-select-option",{attrs:{value:e.id}},[t._v(t._s(e.name)+"\n\t\t\t\t\t")])]}))],2)]:t._e(),2==t.agentType?[a("a-form-item",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[a("template",{slot:"label"},[a("span",{staticStyle:{color:"red"}},[t._v(" * ")]),t._v("应用Id\n\t\t\t\t")]),a("a-input",{attrs:{placeholder:"请输入自建应用的AgentId"},model:{value:t.addAgentId,callback:function(e){t.addAgentId=e},expression:"addAgentId"}})],2),a("a-form-item",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[a("template",{slot:"label"},[a("span",{staticStyle:{color:"red"}},[t._v(" * ")]),t._v("应用Secret\n\t\t\t\t")]),a("a-input",{attrs:{placeholder:"请输入自建应用的Secret"},model:{value:t.addAgentSecret,callback:function(e){t.addAgentSecret=e},expression:"addAgentSecret"}})],2)]:t._e()],2)],1)},s=[],n=(a("96cf"),a("3b8d")),o=(a("c5f6"),{props:{showAddAgent:{type:Boolean,default:!1},agent_is_money:{type:Number,default:1},corpId:{type:String,default:localStorage.getItem("corpId")}},name:"index",data:function(){return{addAgentId:"",addAgentSecret:"",agentList:[],agent_id:"",suite_id:1,agentType:1,showAddAgentModal:!1}},mounted:function(){this.showAddAgentModal=this.showAddAgent},methods:{getAgentList:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-group-sending/agent-list",{corp_id:this.corpId,suite_id:this.suite_id,agent_type:2});case 2:e=t.sent,a=e.data,0!=a.error?(this.isLoading=!1,this.$message.error(a.error_msg)):a.data&&a.data.length>0?(this.agentList=a.data,this.agent_id=this.agentList[0].id,this.agentType=1):this.agentType=2;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addAgentOk:function(){if(1==this.agentType)this.linkAgent();else if(2==this.agentType){if(""==this.addAgentId)return this.$message.error("请输入应用Id！"),!1;if(""==this.addAgentSecret)return this.$message.error("请输入应用Secret！"),!1;this.addAgent()}},linkAgent:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-agent/update-agent-use",{corp_id:this.corpId,agent_id:this.agent_id,agent_is_money:this.agent_is_money});case 2:e=t.sent,a=e.data,0!=a.error?this.$message.error("关联失败，请检查是否正确！"):(this.$message.success("关联成功！"),this.$emit("linkOk"));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addAgent:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post("work-agent/add",{corp_id:this.corpId,agent_id:this.addAgentId,agent_secret:this.addAgentSecret,agent_is_money:this.agent_is_money});case 2:if(e=t.sent,a=e.data,0==a.error){t.next=8;break}this.$message.error("添加失败，请检查是否正确！"),t.next=13;break;case 8:return t.next=10,this.axios.post("work-agent/get",{corp_id:this.corpId,agent_id:a.data.agent_id});case 10:i=t.sent,s=i.data,0!=s.error?this.$message.error("添加失败，请检查是否正确！错误描述："+s.error_msg):(this.addAgentId="",this.addAgentSecret="",this.$message.success("添加成功！"),this.$emit("addOk"));case 13:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addAgentCancel:function(){this.addAgentId="",this.addAgentSecret="",this.$emit("addCancel")}},watch:{showAddAgent:{handler:function(t){this.showAddAgentModal=t,this.getAgentList()},deep:!0}}}),r=o,c=a("2877"),l=Object(c["a"])(r,i,s,!1,null,"6a23fac6",null);e["a"]=l.exports},"8e8f":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,".btn-primary[data-v-d6eb7ff8]{margin-left:20px}[data-v-d6eb7ff8] .ant-tag-checkable{background-color:#fafafa;border-color:#d9d9d9;margin:0 5px}[data-v-d6eb7ff8] .ant-tag-checkable-checked{background-color:#1890ff}",""])},acf6:function(t,e,a){"use strict";var i=a("2c69"),s=a.n(i);s.a},c472:function(t,e,a){"use strict";var i=a("3dc0"),s=a.n(i);s.a},da1d:function(t,e,a){var i=a("2e86");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=a("499e").default;s("466f3054",i,!0,{sourceMap:!1,shadowMode:!1})},eb31:function(t,e,a){"use strict";var i=a("37d7"),s=a.n(i);s.a}}]);